<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Plagiarism Engine</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="styles.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
</head>
<body>
    <div class="page-shell">
        <header class="nav">
            <div class="nav-left">
                <div class="logo">AI<span class="logo-highlight">Plagiarism</span></div>
                <span class="nav-badge">Perplexity + Burstiness</span>
            </div>
            <div class="nav-right">
                <div class="status" id="modelStatus" aria-live="polite">
                    <span class="status-dot active"></span>
                    <span class="status-text">Model Active</span>
                </div>

                <!-- Auth: shows login button or user avatar -->
                <div id="authContainer" class="auth-container">
                    <!-- Not logged in -->
                    <button id="loginBtn" class="auth-btn" type="button" onclick="openAuthModal('login')" title="Sign In">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Sign In
                    </button>
                    <!-- Logged in (hidden by default) -->
                    <button id="userAvatarBtn" class="user-avatar-btn" type="button" onclick="toggleUserMenu()" style="display:none;" title="Account">
                        <span id="userInitial" class="user-initial">?</span>
                    </button>
                    <!-- User dropdown -->
                    <div id="userMenu" class="user-menu" style="display:none;">
                        <div class="user-menu-header">
                            <div id="userMenuName" class="user-name">User</div>
                            <div id="userMenuEmail" class="user-email">email</div>
                        </div>
                        <button onclick="handleLogout()" class="user-menu-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Sign Out
                        </button>
                    </div>
                </div>

                <button class="icon-button" type="button" aria-label="Settings">
                    <span class="icon-gear"></span>
                </button>
            </div>
        </header>

        <main class="main">
            <section id="input-panel" class="panel panel-main">
                <div class="panel-header">
                    <div>
                        <p class="eyebrow">Secure inference workspace</p>
                        <h1>Plagiarism Checker</h1>
                        <p class="lede">Paste text or upload a document to evaluate AI authorship likelihood.</p>
                    </div>
                    <label class="monospace-toggle">
                        <input type="checkbox" id="monospaceToggle" aria-label="Toggle monospace input">
                        <span class="toggle-shape"></span>
                        <span class="toggle-label">Monospace</span>
                    </label>
                </div>

                <!-- Mode Tabs -->
                <div class="mode-tabs" id="modeTabs">
                    <button class="mode-tab active" data-mode="analyze" onclick="switchMode('analyze')">
                        <span class="mode-icon">üîç</span> Analyze
                    </button>
                    <button class="mode-tab" data-mode="compare" onclick="switchMode('compare')">
                        <span class="mode-icon">‚öñ</span> Compare Texts
                    </button>
                    <button class="mode-tab" data-mode="batch" onclick="switchMode('batch')">
                        <span class="mode-icon">üì¶</span> Batch Analysis
                    </button>
                </div>

                <!-- Analyze Mode (default) -->
                <div class="mode-content active" id="modeAnalyze">
                    <div class="textarea-wrap">
                        <textarea id="textInput" placeholder="Paste text here or drop a file" aria-label="Text to analyze"></textarea>
                        <div class="textarea-meta">
                            <span id="charCounter">0 characters</span>
                            <span id="uploadStatus" class="upload-status" aria-live="polite"></span>
                        </div>
                    </div>
                    <div class="controls">
                        <label for="fileInput" class="upload-button">
                            <span class="upload-icon" aria-hidden="true"></span>
                            <span>Upload File</span>
                        </label>
                        <input type="file" id="fileInput" accept=".txt,.docx,.pdf" hidden>
                        <button id="analyzeBtn" class="primary" type="button">Analyze</button>
                    </div>
                </div>

                <!-- Compare Mode -->
                <div class="mode-content" id="modeCompare">
                    <div class="compare-grid">
                        <div class="compare-pane">
                            <label class="compare-label">Text 1 (Original)</label>
                            <textarea id="compareText1" placeholder="Paste the original text here..." aria-label="Original text"></textarea>
                            <div class="compare-upload-row">
                                <label for="compareFile1" class="upload-button upload-sm">
                                    <span class="upload-icon" aria-hidden="true"></span> Upload
                                </label>
                                <input type="file" id="compareFile1" accept=".txt,.docx,.pdf" hidden>
                                <span id="compareStatus1" class="upload-status"></span>
                            </div>
                        </div>
                        <div class="compare-divider">VS</div>
                        <div class="compare-pane">
                            <label class="compare-label">Text 2 (Suspect)</label>
                            <textarea id="compareText2" placeholder="Paste the suspect text here..." aria-label="Suspect text"></textarea>
                            <div class="compare-upload-row">
                                <label for="compareFile2" class="upload-button upload-sm">
                                    <span class="upload-icon" aria-hidden="true"></span> Upload
                                </label>
                                <input type="file" id="compareFile2" accept=".txt,.docx,.pdf" hidden>
                                <span id="compareStatus2" class="upload-status"></span>
                            </div>
                        </div>
                    </div>
                    <div class="controls">
                        <button id="compareBtn" class="primary" type="button" onclick="runComparison()">Compare Texts</button>
                    </div>
                </div>

                <!-- Batch Mode -->
                <div class="mode-content" id="modeBatch">
                    <div class="batch-dropzone" id="batchDropzone">
                        <p class="batch-dropzone-text">
                            <span class="batch-dropzone-icon">üìÅ</span>
                            Drop multiple files here or click to select
                        </p>
                        <input type="file" id="batchFileInput" accept=".txt,.docx,.pdf" multiple hidden>
                        <p class="batch-dropzone-hint">Supports .txt, .docx, .pdf ¬∑ Max 20 files</p>
                    </div>
                    <div id="batchFileList" class="batch-file-list"></div>
                    <div class="controls">
                        <button id="batchAnalyzeBtn" class="primary" type="button" onclick="runBatchAnalysis()">Analyze All Files</button>
                    </div>
                </div>
            </section>

            <section id="loader" class="loader hidden" aria-live="polite" aria-busy="false">
                <div class="loader-card">
                    <div class="spline-shell" id="splineContainer"></div>
                    <div class="loader-copy">
                        <p class="eyebrow">Inference running</p>
                        <p class="loader-text">Evaluating perplexity, burstiness, and semantic drift...</p>
                    </div>
                </div>
            </section>

            <section id="errorCard" class="panel error-card hidden" role="alert">
                <div class="error-stripe"></div>
                <div>
                    <p class="eyebrow">Issue detected</p>
                    <p id="errorMessage" class="error-message">An error occurred</p>
                </div>
                <button id="retryBtn" class="secondary" type="button">Retry</button>
            </section>

            <section id="results" class="results-grid hidden" aria-live="polite">
                <article class="panel verdict-card">
                    <div class="panel-title">
                        <p class="eyebrow">Verdict</p>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <button class="icon-button" id="shareBtn" type="button" aria-label="Share report" title="Share report">‚Üó</button>
                            <div class="risk-badge" id="riskBadge">Low Risk</div>
                        </div>
                    </div>
                    <div class="verdict-metrics">
                        <div class="metric">
                            <span>AI Probability</span>
                            <strong id="aiProbability">0%</strong>
                        </div>
                        <div class="metric">
                            <span>Human Probability</span>
                            <strong id="humanProbability">0%</strong>
                        </div>
                        <div class="metric">
                            <span>Confidence</span>
                            <strong id="confidenceScore">0%</strong>
                        </div>
                    </div>
                    <p id="verdictText" class="verdict-text">Awaiting analysis</p>
                    <ul id="verdictReasons" class="verdict-reasons"></ul>
                </article>

                <article class="panel gauge-card">
                    <div class="panel-title">
                        <p class="eyebrow">AI Detection Gauge</p>
                        <span class="panel-help">Overall AI probability</span>
                    </div>
                    <div id="gaugeChart" class="chart chart-plotly"></div>
                </article>

                <article class="panel metrics-card">
                    <div class="panel-title">
                        <p class="eyebrow">Technical Metrics</p>
                        <button class="icon-button" id="copyMetrics" type="button" aria-label="Copy metrics">‚ßâ</button>
                    </div>
                    <div class="metrics-grid">
                        <div class="metric-row"><span>Perplexity</span><strong id="perplexity">‚Äî</strong></div>
                        <div class="metric-row"><span>Burstiness</span><strong id="burstiness">‚Äî</strong></div>
                        <div class="metric-row"><span>Token Count</span><strong id="tokenCount">‚Äî</strong></div>
                        <div class="metric-row"><span>Model</span><strong id="modelUsed">‚Äî</strong></div>
                        <div class="metric-row"><span>Inference Time</span><strong id="inferenceTime">‚Äî</strong></div>
                        <div class="metric-row"><span>Entropy</span><strong id="entropy">‚Äî</strong></div>
                    </div>
                </article>

                <article class="panel radar-card">
                    <div class="panel-title">
                        <p class="eyebrow">Signal Radar</p>
                        <span class="panel-help">Multi-dimensional AI signal analysis</span>
                    </div>
                    <div id="radarChart" class="chart chart-plotly"></div>
                </article>

                <article class="panel forensic-card">
                    <div class="panel-title">
                        <p class="eyebrow">Text Forensics</p>
                        <span class="panel-help">Paragraph consistency and predictability</span>
                    </div>
                    <div class="forensic-list" id="forensicList"></div>
                </article>

                <article class="panel heatmap-card" id="heatmapCard">
                    <div class="panel-title">
                        <p class="eyebrow">Sentence AI Heatmap</p>
                        <div class="heatmap-controls">
                            <span class="panel-help">Color-coded by AI probability</span>
                            <button class="heatmap-toggle" id="heatmapToggle" type="button" aria-pressed="true">
                                <span class="toggle-icon">‚óâ</span> Heatmap
                            </button>
                        </div>
                    </div>
                    <div class="heatmap-legend">
                        <div class="legend-bar"></div>
                        <div class="legend-labels">
                            <span>Human-likely</span>
                            <span>Uncertain</span>
                            <span>AI-likely</span>
                        </div>
                    </div>
                    <div id="heatmapContainer" class="heatmap-container">
                        <p class="heatmap-placeholder">Analyzing sentences‚Ä¶</p>
                    </div>
                </article>

                <article class="panel voice-card" id="voiceCard">
                    <div class="panel-title">
                        <p class="eyebrow">Voice Consistency</p>
                        <span class="panel-help">Passive vs Active voice analysis</span>
                    </div>
                    <div class="voice-summary" id="voiceSummary">
                        <p class="voice-placeholder">Analyzing voice patterns‚Ä¶</p>
                    </div>
                    <div class="voice-ratio-bar" id="voiceRatioBar"></div>
                    <div class="voice-assessment" id="voiceAssessment"></div>
                    <div class="voice-flagged" id="voiceFlagged"></div>
                </article>

                <article class="panel chart-card">
                    <div class="panel-title">
                        <p class="eyebrow">Word Frequency</p>
                        <span class="panel-help">Top tokens ¬∑ use toolbar for lasso, zoom, pan</span>
                    </div>
                    <div id="freqChart" class="chart chart-plotly"></div>
                </article>

                <article class="panel suggestion-card">
                    <div class="panel-title">
                        <p class="eyebrow">Replacement Suggestions</p>
                        <span class="panel-help">Reduce repetition with alternatives</span>
                    </div>
                    <div id="suggestionList" class="suggestion-list"></div>
                </article>

                <!-- Full Analysis Report -->
                <article class="panel report-card" id="reportCard" style="grid-column: 1 / -1;">
                    <div class="panel-title">
                        <p class="eyebrow">Analysis Report</p>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <button class="download-report-btn" id="downloadReportBtn" type="button" aria-label="Download Report" title="Download Report as PDF">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download Report
                            </button>
                        </div>
                    </div>
                    <div id="reportContent" class="report-content">
                        <p class="heatmap-placeholder">Generating report‚Ä¶</p>
                    </div>
                </article>

                <!-- Community Feedback -->
                <article class="panel feedback-card" id="feedbackCard" style="grid-column: 1 / -1;">
                    <div class="panel-title">
                        <p class="eyebrow">Was this detection accurate?</p>
                        <span class="panel-help" id="feedbackTrust"></span>
                    </div>
                    <div class="feedback-body">
                        <p class="feedback-question">Help improve our AI detection by confirming or correcting this result.</p>
                        <div class="feedback-buttons">
                            <button class="feedback-btn feedback-correct" id="feedbackCorrectBtn" onclick="submitFeedback(true)" type="button">
                                <span>üëç</span> Correct
                            </button>
                            <button class="feedback-btn feedback-incorrect" id="feedbackIncorrectBtn" onclick="submitFeedback(false)" type="button">
                                <span>üëé</span> Incorrect
                            </button>
                        </div>
                        <p class="feedback-status" id="feedbackStatus"></p>
                    </div>
                </article>

                <!-- Cross-Document Plagiarism Ring -->
                <article class="panel crossdoc-card" id="crossDocCard" style="grid-column: 1 / -1;">
                    <div class="panel-title">
                        <p class="eyebrow">Cross-Document Similarity</p>
                        <span class="panel-help">Compared against stored documents</span>
                    </div>
                    <div id="crossDocContent" class="crossdoc-content">
                        <p class="heatmap-placeholder">Checking for similar documents‚Ä¶</p>
                    </div>
                </article>
            </section>

            <!-- Compare Results (separate from main results) -->
            <section id="compareResults" class="compare-results hidden">
                <article class="panel" style="grid-column: 1 / -1;">
                    <div class="panel-title">
                        <p class="eyebrow">Comparison Results</p>
                        <span class="panel-help" id="compareVerdict"></span>
                    </div>
                    <div class="compare-stats-grid" id="compareStatsGrid"></div>
                    <div class="compare-similarity-bar" id="compareSimilarityBar"></div>
                    <div class="compare-diff-view" id="compareDiffView"></div>
                </article>
            </section>

            <!-- Batch Results (separate from main results) -->
            <section id="batchResults" class="batch-results hidden">
                <article class="panel" style="grid-column: 1 / -1;">
                    <div class="panel-title">
                        <p class="eyebrow">Batch Analysis Results</p>
                        <span class="panel-help" id="batchSummary"></span>
                    </div>
                    <div id="batchSummaryGrid" class="batch-summary-grid"></div>
                    <div id="batchResultsTable" class="batch-table-wrap"></div>
                    <div class="panel-title" style="margin-top: 20px;">
                        <p class="eyebrow">Cross-Similarity Matrix</p>
                        <span class="panel-help">How similar each document is to others</span>
                    </div>
                    <div id="batchMatrix" class="batch-matrix-wrap"></div>
                    <div id="batchSuspicious" class="batch-suspicious"></div>
                </article>
            </section>
        </main>

        <footer class="footer">
            <span>AI Plagiarism Engine ¬∑ Perplexity + Burstiness + Entropy</span>
        </footer>

        <!-- History Sidebar -->
        <aside id="historyPanel" style="
            position: fixed;
            right: 0;
            top: 60px;
            width: 300px;
            height: calc(100vh - 60px);
            background: var(--bg, #faf4e8);
            border-left: 2px solid var(--border, #1a1a1a);
            padding: 16px;
            overflow-y: auto;
            z-index: 100;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        ">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <p class="eyebrow" style="margin:0;">Scan History</p>
                <button onclick="toggleHistory()" style="
                    background:none;
                    border:2px solid var(--border, #1a1a1a);
                    border-radius:8px;
                    cursor:pointer;
                    padding:4px 8px;
                    font-weight:700;
                    font-size:0.8rem;
                ">‚úï</button>
            </div>
            <div id="historyList">
                <p style="color:var(--muted, #6b5c42);text-align:center;padding:16px;">Loading history‚Ä¶</p>
            </div>
        </aside>
    </div>

    <button id="historyToggleBtn" onclick="toggleHistory()" style="
        position: fixed;
        right: 16px;
        bottom: 20px;
        z-index: 101;
        background: var(--bg, #faf4e8);
        border: 2px solid var(--border, #1a1a1a);
        border-radius: 50%;
        width: 48px;
        height: 48px;
        cursor: pointer;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        transition: transform 0.2s ease;
    " onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" title="Scan History" aria-label="Toggle scan history">
        üìã
    </button>

    <script>
        let historyOpen = false;
        function toggleHistory() {
            historyOpen = !historyOpen;
            const panel = document.getElementById('historyPanel');
            panel.style.transform = historyOpen ? 'translateX(0)' : 'translateX(100%)';
        }
    </script>

    <!-- Auth Modal -->
    <div id="authModal" class="auth-overlay" style="display:none;" onclick="if(event.target===this)closeAuthModal()">
        <div class="auth-modal">
            <button class="auth-close" onclick="closeAuthModal()" aria-label="Close">&times;</button>

            <div class="auth-tabs">
                <button id="tabLogin" class="auth-tab active" onclick="switchAuthTab('login')">Sign In</button>
                <button id="tabSignup" class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="auth-form" onsubmit="handleLogin(event)">
                <div class="auth-field">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="you@example.com" required autocomplete="email">
                </div>
                <div class="auth-field">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6" autocomplete="current-password">
                </div>
                <p id="loginError" class="auth-error" style="display:none;"></p>
                <button type="submit" class="primary auth-submit" id="loginSubmitBtn">Sign In</button>
                <p class="auth-switch">Don't have an account? <a href="#" onclick="switchAuthTab('signup');return false;">Sign Up</a></p>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="auth-form" style="display:none;" onsubmit="handleSignup(event)">
                <div class="auth-field">
                    <label for="signupName">Full Name</label>
                    <input type="text" id="signupName" placeholder="John Doe" autocomplete="name">
                </div>
                <div class="auth-field">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" placeholder="you@example.com" required autocomplete="email">
                </div>
                <div class="auth-field">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" placeholder="Min. 6 characters" required minlength="6" autocomplete="new-password">
                </div>
                <p id="signupError" class="auth-error" style="display:none;"></p>
                <p id="signupSuccess" class="auth-success" style="display:none;"></p>
                <button type="submit" class="primary auth-submit" id="signupSubmitBtn">Create Account</button>
                <p class="auth-switch">Already have an account? <a href="#" onclick="switchAuthTab('login');return false;">Sign In</a></p>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>